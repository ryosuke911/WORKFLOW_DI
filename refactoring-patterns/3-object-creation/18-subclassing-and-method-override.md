## 18. サブクラス化とメソッドのオーバーライド

## **概要**

「サブクラス化とメソッドのオーバーライド」とは、親クラス（スーパークラス）のメソッドをサブクラスでオーバーライド（上書き）することによって、特定の処理をカスタマイズしたり、挙動を変更する手法です。

この手法は、親クラスの設計を保持しつつ、特定の機能を変更したい場合に役立ちます。また、テストやモック（模擬オブジェクト）の作成時にも頻繁に使用されます。

具体的な特徴は以下の通りです：

1. **動作の部分的な変更**：既存のメソッドの振る舞いを変えたい場合に使用します。
2. **依存関係の緩和**：テスト環境で依存オブジェクトを差し替える際に役立ちます。
3. **再利用性と拡張性**：親クラスのコードを再利用しながら、必要な部分のみを変更することができます。

---

## **この手法が必要になる場面**

### **1. 特定の依存関係を分離・テストする必要がある場合**

既存のコードが特定の外部依存に強く結びついている場合、サブクラスを用いてその依存関係を切り離し、テスト時に差し替えることができます。たとえば、データベースや外部サービスへの依存をモックで置き換えたい場合です。

### **2. 機能をカスタマイズしたい場合**

親クラスの汎用的なメソッドをカスタマイズして、特定の要件に応じた処理を追加または変更したい場合に使用します。

### **3. 柔軟な設計を求める場合**

親クラスの基本的な構造や振る舞いを保持しつつ、特定の箇所を変更したい場合に有効です。この手法は、継承とポリモーフィズム（多態性）を活用した柔軟な設計を可能にします。

---

## **手順**

1. **分離したい依存関係や変更箇所を特定する**
どのメソッドや機能を変更・分離する必要があるかを明確にします。
2. **対象のメソッドをオーバーライド可能にする**
既存のメソッドをオーバーライドできるよう、`protected`または`public`に可視性を変更します。Javaではデフォルトで`final`指定されている場合、`final`を外します。
3. **サブクラスを作成してオーバーライドする**
必要に応じて、新しいクラス（サブクラス）を作成し、親クラスのメソッドをオーバーライドします。
4. **オーバーライドしたメソッドが正しく機能するかテストする**
テストハーネスを用いて、期待した挙動を確認します。

---

## **Javaコード例**

以下は、「サブクラス化とメソッドのオーバーライド」を利用した具体例です。

---

### **親クラスのコード例**

以下は、ログの書き込みを行うメソッドを含む`Account`クラスの例です。

```java
public class Account {
    private int balance;

    public void deposit(int value) {
        balance += value; // 残高を更新
        logDeposit(value); // ログを記録
    }

    // ログを記録するメソッド
    protected void logDeposit(int value) {
        System.out.println("Deposit: " + value);
    }
}

```

- `deposit()`メソッドは残高を更新し、その操作をログに記録します。
- `logDeposit()`メソッドは、特定のフォーマットでログを記録する役割を持っています。

---

### **サブクラスを利用してログの動作を変更**

以下は、ログの出力形式を変更するためのサブクラス`TestingAccount`の例です。

```java
public class TestingAccount extends Account {
    @Override
    protected void logDeposit(int value) {
        System.out.println("Test Log: Deposit of " + value + " units.");
    }
}

```

- `TestingAccount`クラスでは、`logDeposit()`メソッドをオーバーライドして、テスト用のログ出力を行うように変更しています。
- このサブクラスを用いることで、本番環境のコードを変更せずにテスト用の動作を作成できます。

---

### **テストシナリオ**

以下は、`TestingAccount`を利用してテストを行う例です。

```java
public class AccountTest {
    public static void main(String[] args) {
        Account testAccount = new TestingAccount(); // サブクラスを利用
        testAccount.deposit(100); // テスト用のログが出力される
    }
}

```

- 実行結果：
    
    ```
    Test Log: Deposit of 100 units.
    
    ```
    

---

## **注意点**

1. **可視性の調整**
サブクラスでオーバーライドするメソッドの可視性は`protected`以上である必要があります。`private`メソッドはオーバーライドできません。
2. **final修飾子の扱い**
Javaでは、`final`指定されたメソッドはオーバーライドできません。設計時に`final`を付ける場合は、オーバーライドが不要か慎重に検討する必要があります。
3. **オーバーライド時のリスク**
オーバーライドによって挙動が変わるため、親クラスとサブクラスの責務を明確にしないと、コードが混乱する可能性があります。十分なテストを行い、意図した動作を確認してください。